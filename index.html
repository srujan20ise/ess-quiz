<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESS Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family: Arial;
  background:#0f172a;
  color:white;
  margin:0;
}
.container{
  max-width:800px;
  margin:auto;
  padding:20px;
}
.card{
  background:#020617;
  padding:20px;
  border-radius:10px;
}
.option{
  border:1px solid #334155;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  cursor:pointer;
}
.option.selected{background:#2563eb;}
.correct{color:#22c55e;}
.wrong{color:#ef4444;}
button{
  background:#38bdf8;
  border:none;
  padding:10px 16px;
  border-radius:6px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

<h2>Environmental Studies Quiz</h2>
<p id="timer" style="color:#facc15;font-weight:bold"></p>


<div id="quiz" class="card">
  <h3 id="qno"></h3>
  <p id="question"></p>
  <div id="options"></div>
  <button onclick="nextQ()">Next</button>
</div>

<div id="result" class="card" style="display:none"></div>

</div>

<script>
// ---------- QUESTIONS ----------
// ---------- LOAD QUESTIONS FROM JSON ----------
let questions = [];

fetch("questions.json")
  .then(response => response.json())
  .then(data => {
    questions = data.map(q => ({
      q: q.question,
      o: q.options,
      a: q.answer
    }));

    // reset timer based on number of questions
    timeLeft = questions.length * 60;

    loadQ();
    startTimer();
  })
  .catch(error => {
    alert("Error loading questions.json");
    console.error(error);
  });


// ---------- VARIABLES ----------
let i = 0;
let selected = null;
let score = 0;
let userAnswers = [];

let timeLeft = questions.length * 60; // 1 minute per question
let timerInterval;

function startTimer(){
  timerInterval = setInterval(() => {
    let m = Math.floor(timeLeft / 60);
    let s = timeLeft % 60;

    document.getElementById("timer").innerText =
      `Time Left: ${m}:${s < 10 ? "0" + s : s}`;

    timeLeft--;

    if(timeLeft < 0){
      clearInterval(timerInterval);
      showResult();
    }
  }, 1000);
}

// ---------- LOAD QUESTION ----------
function loadQ(){
  const q = questions[i];
  document.getElementById("qno").innerText = "Question " + (i+1);
  document.getElementById("question").innerText = q.q;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.o.forEach((text, idx) => {
    const div = document.createElement("div");
    div.className = "option";
    div.innerText = text;
    div.onclick = () => selectOpt(idx, div);
    optDiv.appendChild(div);
  });
}

// ---------- SELECT OPTION ----------
function selectOpt(idx, div){
  document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
  div.classList.add("selected");
  selected = idx;
}

// ---------- NEXT QUESTION ----------
function nextQ(){
  if(selected === null){
    alert("Please select an option");
    return;
  }

  userAnswers.push(selected);
  if(selected === questions[i].a) score++;

  selected = null;
  i++;

  if(i < questions.length){
    loadQ();
  }else{
    showResult();
  }
}

// ---------- SHOW RESULT ----------
function showResult(){
 clearInterval(timerInterval);
 document.getElementById("quiz").style.display = "none";
  const res = document.getElementById("result");
  res.style.display = "block";

  let html = `<h2>Score: ${score} / ${questions.length}</h2><hr>`;

  questions.forEach((q, idx) => {
    html += `<p><b>Q${idx+1}.</b> ${q.q}</p>`;
    q.o.forEach((opt, j) => {
      if(j === q.a){
        html += `<div class="correct">✔ ${opt}</div>`;
      }else if(j === userAnswers[idx]){
        html += `<div class="wrong">✘ ${opt}</div>`;
      }else{
        html += `<div>${opt}</div>`;
      }
    });
    html += `<hr>`;
  });

  res.innerHTML = html;
}

// ---------- START ----------


</script>

</body>
</html>
